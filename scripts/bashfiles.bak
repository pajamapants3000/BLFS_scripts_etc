#!/bin/bash -ev
# Beyond Linux From Scratch
# Bash shell startup files and other initial configurations
######################
#
### RUN AS ROOT!!! ###
#
######################
#
# Check for previous installation:
PROCEED="yes"
grep bashfiles /list-$CHRISTENED"-"$SURNAME > /dev/null && ((\!$?)) &&\
    echo "Previous installation detected, proceed?" && read PROCEED
[ $PROCEED = "yes" ] || [ $PROCEED = "y" ] || exit 0
#
source /etc/bashrc
#
install --directory --mode=0755 --owner=root --group=root /etc/profile.d
cp -v files/etc/profile.d/* /etc/profile.d/
chown -v root:root /etc/profile.d/*
chmod -v 755 /etc/profile.d/*
#
install --directory --mode=0755 --owner=root --group=root /etc/profile.d/active
cp -v files/etc/active/* /etc/profile.d/active/
chown -v root:root /etc/profile.d/active/*
chmod -v 755 /etc/profile.d/active/*
#
dircolors -p > /etc/dircolors
#
for FILE in $(ls file/etc); do
    if [ -f file/etc/$FILE ]; then
        cp -v file/etc/"${FILE}" /etc/
        chown -v root:root /etc/"${FILE}"
        chmod -v 755 /etc/"${FILE}"
    fi
done

cp -rv files/home/. /etc/skel/
chown -vR root:root /etc/skel/.
chown -vR root:root /etc/skel/*
chmod -vR 644 /etc/skel/.
chmod -vR 644 /etc/skel/*

useradd -m -U -G wheel,video,audio,usb,cdrom -s /bin/bash tommy

tar -xvf sources/blfs-bootscripts-20150304.tar.bz2
cd blfs-bootscripts-20150304
make install-random
cd ..
# Add to list of installed programs on this system
echo "bashfiles" >> /list"-"$CHRISTENED"-"$SURNAME
#
